dist: trusty
group: edge
language: python
python:
- 2.7.13
before_install:
- openssl aes-256-cbc -K $encrypted_ee45e5c35c00_key -iv $encrypted_ee45e5c35c00_iv
  -in fabscanpi.key.enc -out ~\/fabscanpi.key -d
- sudo apt-get -qq update
- sudo apt-get install -y build-essential python-setuptools debhelper cdbs dh-python
  fakeroot python-pip rsync
before_script:
- CURRENT_DATE=$(date +%Y%m%d%H%M)
- pip install mkdocs
- VERSION=$(head -1 debian/changelog | awk -F'[()]' '{print $2}')
- if [ -z ${TRAVIS_TAG} ]; then sed -i -e 's/'"$VERSION"'/'"$VERSION"'+'"$CURRENT_DATE"'/g'
  debian/changelog; fi
- echo $TRAVIS_TAG
script: sudo make deb
after_success:
- ls -alh ../*.deb
- travis_wait curl  -T ../*.deb sftp://$FTPUSER:$FTPPASSWORD@mariolukas.de:2222/release
  --insecure
env:
  global:
  - secure: "k0Ms4zQL6KTWInxaS2G578OxmG2aJSicezcGESsDHg3RLI7zgyx4jn+3IdoGfZucXmMxjwPFpBvoVBYfJ4GY5ZrgV8ftvnReO7xn8obADtOmSupTy5eUX5S/K+b8VdjD/QQRO9Bn9lz7ekTauMqtv2usw93X3RTDFtEAtLwtBEuGMU4dhU1lHC/1HDxa0BGfhuEOsp9eedA641dwq3kVpw/6WRlpdyNLEL6l7HJ2ednOH+DXb5hTwSF+Wbg/Oe/pobn8xpFvYc8ZmlRVpiE0kL3lA4HZ5gdBCHAs9HuNsK8e3pKn9l71zqEFdZdbUylp/fFeN5uLYMnZSMKBOg03lRhtsICm6IN7d91Hazcd+vox5Jh0EBgKsEgrAoDSMjiMRj1ROnZXWgs/DYZh8nV+y23hY3BlvyD2AjwyxCHRLG4sIkGmhxe3EoaW1vBwZ4/QUp7AL6x9povUsJM4kU6sBu0+QaoKk1NKs+2xW4mpktS5i2WHuR/sJcmf8AWDkuTejSKBzmKJoSb2dluRYKHa7EpobA7hiCz+6Und13sGJDvF46QprCkuVmDeQc1wImpVj2Evn0KLRRq4z33mEtoMMbROJ1Pg7pXdaTvl9AxDHn60NIbfr7lWjcYIvaOpPSax5vCD6w2lDToDbwj/4K5mh80/bhOyWVCrfcJxQOYqxxQ="
  - secure: "pItiIj1nNMzLGtmbtTPCN7Fc8P6W1FpEGJGb3odWSBRJzHUr6V7G6W333PgaktwrIa8xrX7JXMoEPWPzSOBQNWe9R2906Bz5IXs/WHtIJNHT+O3q8M0WzhrhSu4cHKymVLjgMkldEI20DZKHnEkXAidJikcrmPA3vDs9RtoAI4rFmcsbKIzIiQvWv8dmUdvucqoI19dmBkM0ONUnkGIbv7TXErGCOA13hEgWv16YCaX1hiROJM6+hZTwRqPv+nWulO1yifSzRMzwlSngRkmYWRW6A42LDnQej0b8QAhLxBU3Igh8FYTlrfAacUqViRxv/UgDhTtFoD36tK2m38tZU4XJ84a5kK/7W7VPpdSVB5ogpjfPG3quGGyAjnNkj2Uynl4x86g7XyIy64JF/c1Ebu/ivoC/M5V9LKA33xDnq9gZB3aKs6xA1+0XOIQ0+yGWaM01UGrP+eY4gTajfAmUFSMPjNC0kr2sV6GEZAixUomIRd2Q65JpLr/vpAcCyxUj6YqmMeZ4IAQ1Tcqfu+6ApkLiTSqu8vFWH/BBbGinyndM6jOjCr9NXA4gQXQzNYdXoa6sio+XBNhIqLyAkS/XfdrKsYui0RQRbxorhc5FN0MqCOiiWreh7oNPkyrV+B9ggvsd2Kce74DFm2k3MdLbXqz0CxFAfVjBKCJmKi0Hr/o="
  - secure: "k0Ms4zQL6KTWInxaS2G578OxmG2aJSicezcGESsDHg3RLI7zgyx4jn+3IdoGfZucXmMxjwPFpBvoVBYfJ4GY5ZrgV8ftvnReO7xn8obADtOmSupTy5eUX5S/K+b8VdjD/QQRO9Bn9lz7ekTauMqtv2usw93X3RTDFtEAtLwtBEuGMU4dhU1lHC/1HDxa0BGfhuEOsp9eedA641dwq3kVpw/6WRlpdyNLEL6l7HJ2ednOH+DXb5hTwSF+Wbg/Oe/pobn8xpFvYc8ZmlRVpiE0kL3lA4HZ5gdBCHAs9HuNsK8e3pKn9l71zqEFdZdbUylp/fFeN5uLYMnZSMKBOg03lRhtsICm6IN7d91Hazcd+vox5Jh0EBgKsEgrAoDSMjiMRj1ROnZXWgs/DYZh8nV+y23hY3BlvyD2AjwyxCHRLG4sIkGmhxe3EoaW1vBwZ4/QUp7AL6x9povUsJM4kU6sBu0+QaoKk1NKs+2xW4mpktS5i2WHuR/sJcmf8AWDkuTejSKBzmKJoSb2dluRYKHa7EpobA7hiCz+6Und13sGJDvF46QprCkuVmDeQc1wImpVj2Evn0KLRRq4z33mEtoMMbROJ1Pg7pXdaTvl9AxDHn60NIbfr7lWjcYIvaOpPSax5vCD6w2lDToDbwj/4K5mh80/bhOyWVCrfcJxQOYqxxQ="
before_deploy:
- export RELEASE_FILE_NAME=$(ls ../*.deb)
after_deploy:
- NOW=`date +%Y-%m-%d-%H-%M`
- cd ..
- git clone https://github.com/mariolukas/FabScanPi-Build-Raspbian.git
- cd FabScanPi-Build-Raspbian
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git tag v.${NOW} -m "new release ${RELEASE_FILE_NAME}"
- git push origin --tags
deploy:
  provider: releases
  skip_cleanup: true
  file_glob: true
  api_key:
    secure: "k0Ms4zQL6KTWInxaS2G578OxmG2aJSicezcGESsDHg3RLI7zgyx4jn+3IdoGfZucXmMxjwPFpBvoVBYfJ4GY5ZrgV8ftvnReO7xn8obADtOmSupTy5eUX5S/K+b8VdjD/QQRO9Bn9lz7ekTauMqtv2usw93X3RTDFtEAtLwtBEuGMU4dhU1lHC/1HDxa0BGfhuEOsp9eedA641dwq3kVpw/6WRlpdyNLEL6l7HJ2ednOH+DXb5hTwSF+Wbg/Oe/pobn8xpFvYc8ZmlRVpiE0kL3lA4HZ5gdBCHAs9HuNsK8e3pKn9l71zqEFdZdbUylp/fFeN5uLYMnZSMKBOg03lRhtsICm6IN7d91Hazcd+vox5Jh0EBgKsEgrAoDSMjiMRj1ROnZXWgs/DYZh8nV+y23hY3BlvyD2AjwyxCHRLG4sIkGmhxe3EoaW1vBwZ4/QUp7AL6x9povUsJM4kU6sBu0+QaoKk1NKs+2xW4mpktS5i2WHuR/sJcmf8AWDkuTejSKBzmKJoSb2dluRYKHa7EpobA7hiCz+6Und13sGJDvF46QprCkuVmDeQc1wImpVj2Evn0KLRRq4z33mEtoMMbROJ1Pg7pXdaTvl9AxDHn60NIbfr7lWjcYIvaOpPSax5vCD6w2lDToDbwj/4K5mh80/bhOyWVCrfcJxQOYqxxQ="
  file: "${RELEASE_FILE_NAME}"
  on:
    tags: true
    repo: mariolukas/FabScanPi-Server
