dist: trusty
group: edge
language: python
python:
- 2.7.13
before_install:
- sudo apt-get -qq update
- sudo apt-get install -y build-essential python-setuptools debhelper cdbs dh-python
  fakeroot python-pip rsync
before_script:
- CURRENT_DATE=$(date +%Y%m%d%H%M)
- pip install mkdocs
- VERSION=$(head -1 debian/changelog | awk -F'[()]' '{print $2}')
- if [ -z ${TRAVIS_TAG} ]; then sed -i -e 's/'"$VERSION"'/'"$VERSION"'+'"$CURRENT_DATE"'/g'
  debian/changelog; fi
- echo $TRAVIS_TAG
script: sudo make deb
after_success:
- ls -alh ../*.deb
- travis_wait curl  -T ../*.deb sftp://$FTPUSER:$FTPPASSWORD@mariolukas.de:2222/release
  --insecure
env:
  global:
  - secure: k0Ms4zQL6KTWInxaS2G578OxmG2aJSicezcGESsDHg3RLI7zgyx4jn+3IdoGfZucXmMxjwPFpBvoVBYfJ4GY5ZrgV8ftvnReO7xn8obADtOmSupTy5eUX5S/K+b8VdjD/QQRO9Bn9lz7ekTauMqtv2usw93X3RTDFtEAtLwtBEuGMU4dhU1lHC/1HDxa0BGfhuEOsp9eedA641dwq3kVpw/6WRlpdyNLEL6l7HJ2ednOH+DXb5hTwSF+Wbg/Oe/pobn8xpFvYc8ZmlRVpiE0kL3lA4HZ5gdBCHAs9HuNsK8e3pKn9l71zqEFdZdbUylp/fFeN5uLYMnZSMKBOg03lRhtsICm6IN7d91Hazcd+vox5Jh0EBgKsEgrAoDSMjiMRj1ROnZXWgs/DYZh8nV+y23hY3BlvyD2AjwyxCHRLG4sIkGmhxe3EoaW1vBwZ4/QUp7AL6x9povUsJM4kU6sBu0+QaoKk1NKs+2xW4mpktS5i2WHuR/sJcmf8AWDkuTejSKBzmKJoSb2dluRYKHa7EpobA7hiCz+6Und13sGJDvF46QprCkuVmDeQc1wImpVj2Evn0KLRRq4z33mEtoMMbROJ1Pg7pXdaTvl9AxDHn60NIbfr7lWjcYIvaOpPSax5vCD6w2lDToDbwj/4K5mh80/bhOyWVCrfcJxQOYqxxQ=
  - secure: eC/n2DmjrbZS43VVUZKw0BHuzGxdQHlArmLTXSEVXTtj6dhPsM4SOlSCBthxM1FA/YYnoftUSYkcJ+3NfP+GXQ2hXCLDpcx7o3yuvv2wDgdm6N8qqG6WPPGl8p5rpZelPf4M1+YD/6DipBEM0KugGOQh0WN385T88EPWsZwQ9p8NlVrclkzage1YvEz/FOE979kWMWStRSsfmo1J83Y5nEnv7RgBdCUdZzAaVFt2nND22OjvrEDKrqgAS7fhZr5A6JhCcISP7tAs8tXwO5ORJLzEyY2XWTwvx2ZvXqe8yOxeZvYZ6MAennNEkhZKptjKlBJ/GD+slGAWBl7HNRklWcmFTUrVzoNrVKbfF+mIBmX5m6iQBeKBcMUFSRgMMBbrusyu632J3bcDgiqUvIV/1Zg3wC1dOKW8+zG4oY8J0Y4br5PlqnR/vlm8ZNZdxpKyqYLDtSARiRt0C9J6i58UDBh5qSLifVGDfeXY1AeIiNQTk+zq+RTmm2sisZ5AMCPnbp2QgnOJFxMpJEvU5sU/bELW2R5MN5nIn3xLtSIY3bVN0dAz4ILdaMAwZHJOsPutaxCFGZUKv9GvxxLLtPxU7jEtwmpWHiqMN1xoqitq+nVdkX4MbRhBlOPUzg08TozA2g0rVrRnffjFFAmbDJcDOuhkni0FLO7Kf+1kf2/mXD0=
  - secure: dlc4S+Z0V4wWPOsXOhcccn8IQmcuPh5GMUJpHPfnYji1XskHW8kQ5YMP9eWrnuIRLQc+xhqs0buKWxIUqmsSHWOH7lrmeaBSTzCqtY8XXCn2XbNsCOoUUsYdgyD0nx8JLkKFE5NT+55UCkXW+zDLTcH8qBNSeVl+N8hGTSVyhjnFhizRx9bM5SE/St+vY95YL+K7bsri1vwCHTyDU+wWfnXIs2f86tHlGM4abnQw1SWUp4iRzEYvq3bWLsgpuwGMif+XOsXbKmuzkD7HbEKfdGTOQ59H5tiloL7BR3cdS0AWKJdYtkUMNGd4YkxhP565557rFifv+qCocU6ab76guZ2XBNzFWa4vHEPqDTwHZ4kXoW4rcamcWTSZnzlfpU7Warr+H+zcoHMpbOv0oxJVhPfVia5WDT6v9WZ7jnkyaWDUoBcgPye3RTIE8Ot6Z3jJcNfhU5T2enLP/m1H6bzTPDwAGx28p6ku8qKO83VM/pyqo30gJZfyALR3v4Rh1v/16H7HmFXDsPMt/Tyjqq4AtO5wkDVpCbsKpNGjMHG/+Gs2WWpaodoXIkhNMZx8uK7PHYduJ5vrHfteowu8ab29HI/1i1TSjLa4xMO64v1nGxrCubbOBtAQdfx6pprxwgyPhaQeSC9exqye1ziOEyOWSPTQmDtLawjG26BKBP8H7XU=
before_deploy:
- export RELEASE_FILE_NAME=$(ls ../*.deb)
after_deploy:
- NOW=`date +%Y-%m-%d-%H-%M`
- cd ..
- git clone https://github.com/mariolukas/FabScanPi-Build-Raspbian.git
- cd FabScanPi-Build-Raspbian
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git tag v.${NOW} -m "new release ${RELEASE_FILE_NAME}"
- git push origin --tags
deploy:
  provider: releases
  skip_cleanup: true
  file_glob: true
  api_key:
    secure: k0Ms4zQL6KTWInxaS2G578OxmG2aJSicezcGESsDHg3RLI7zgyx4jn+3IdoGfZucXmMxjwPFpBvoVBYfJ4GY5ZrgV8ftvnReO7xn8obADtOmSupTy5eUX5S/K+b8VdjD/QQRO9Bn9lz7ekTauMqtv2usw93X3RTDFtEAtLwtBEuGMU4dhU1lHC/1HDxa0BGfhuEOsp9eedA641dwq3kVpw/6WRlpdyNLEL6l7HJ2ednOH+DXb5hTwSF+Wbg/Oe/pobn8xpFvYc8ZmlRVpiE0kL3lA4HZ5gdBCHAs9HuNsK8e3pKn9l71zqEFdZdbUylp/fFeN5uLYMnZSMKBOg03lRhtsICm6IN7d91Hazcd+vox5Jh0EBgKsEgrAoDSMjiMRj1ROnZXWgs/DYZh8nV+y23hY3BlvyD2AjwyxCHRLG4sIkGmhxe3EoaW1vBwZ4/QUp7AL6x9povUsJM4kU6sBu0+QaoKk1NKs+2xW4mpktS5i2WHuR/sJcmf8AWDkuTejSKBzmKJoSb2dluRYKHa7EpobA7hiCz+6Und13sGJDvF46QprCkuVmDeQc1wImpVj2Evn0KLRRq4z33mEtoMMbROJ1Pg7pXdaTvl9AxDHn60NIbfr7lWjcYIvaOpPSax5vCD6w2lDToDbwj/4K5mh80/bhOyWVCrfcJxQOYqxxQ=
  file: "${RELEASE_FILE_NAME}"
  on:
    tags: true
    repo: mariolukas/FabScanPi-Server
