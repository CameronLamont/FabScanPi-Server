dist: trusty
group: edge
language: python
python:
- 2.7
before_install:
- openssl aes-256-cbc -K $encrypted_ee45e5c35c00_key -iv $encrypted_ee45e5c35c00_iv
  -in fabscanpi.key.enc -out ~\/fabscanpi.key -d
- sudo apt-get -qq update
- sudo apt-get install -y build-essential python-setuptools debhelper cdbs dh-python
  fakeroot python-pip rsync
before_script:
- CURRENT_DATE=$(date +%Y%m%d%H%M)
- pip install mkdocs
- VERSION=$(head -1 debian/changelog | awk -F'[()]' '{print $2}')
- if [ -z ${TRAVIS_TAG} ]; then sed -i -e 's/'"$VERSION"'/'"$VERSION"'+'"$CURRENT_DATE"'/g'
  debian/changelog; fi
- echo $TRAVIS_TAG
script: sudo make deb
after_success:
- FILE_NAME=$(ls -a ../*.deb)
- travis_wait curl -T ../$FILE_NAME -u $FTPUSER:$FTPPASSWORD ftp://mariolukas.de/release/
env:
  global:
  - secure: k0Ms4zQL6KTWInxaS2G578OxmG2aJSicezcGESsDHg3RLI7zgyx4jn+3IdoGfZucXmMxjwPFpBvoVBYfJ4GY5ZrgV8ftvnReO7xn8obADtOmSupTy5eUX5S/K+b8VdjD/QQRO9Bn9lz7ekTauMqtv2usw93X3RTDFtEAtLwtBEuGMU4dhU1lHC/1HDxa0BGfhuEOsp9eedA641dwq3kVpw/6WRlpdyNLEL6l7HJ2ednOH+DXb5hTwSF+Wbg/Oe/pobn8xpFvYc8ZmlRVpiE0kL3lA4HZ5gdBCHAs9HuNsK8e3pKn9l71zqEFdZdbUylp/fFeN5uLYMnZSMKBOg03lRhtsICm6IN7d91Hazcd+vox5Jh0EBgKsEgrAoDSMjiMRj1ROnZXWgs/DYZh8nV+y23hY3BlvyD2AjwyxCHRLG4sIkGmhxe3EoaW1vBwZ4/QUp7AL6x9povUsJM4kU6sBu0+QaoKk1NKs+2xW4mpktS5i2WHuR/sJcmf8AWDkuTejSKBzmKJoSb2dluRYKHa7EpobA7hiCz+6Und13sGJDvF46QprCkuVmDeQc1wImpVj2Evn0KLRRq4z33mEtoMMbROJ1Pg7pXdaTvl9AxDHn60NIbfr7lWjcYIvaOpPSax5vCD6w2lDToDbwj/4K5mh80/bhOyWVCrfcJxQOYqxxQ=
  - secure: Z+4LQcFyKxt+PV7iO/ReFTjhUUSchvxpdLodv79swNj10De0qZCyiPiFk2qrxUgQtd7hkhYLqaSPZ/Xwoz6kNkiYE/ebj3gMDBzDhPymAujNXsg3VPomT9yG9fhwiXkjAYhBdn1VaNA4cMuShWPdTQAgwFtpZqQPsUmCzlyI7CHBhv6krEEzKOR+SLQH6gVcAE/7mROcEf0tTHmr2Wommhip0tVdJVbuoiYOCsex2bBhJqjZ+/HMuxmzoMRbTCwFkJkPlWjuasaH4zJMQCXpgkn4jU4wSG8zlzHM+QvbyGLbcg9mPF9PJONwnCt2e8mTFTZfMNKloZv1UavNZv/nnAVnUbjto8583v+wBna019Oxd3onv58A8DBcw16vEKQJVq05QFcMjcEiXyJpV1BoJX0dI56WsZcRWFg3ZMtHFZEDK0CryiAdwzaGzPlNNiMwsZyqUcL9nUh8tl3/xJQPtUdIMCE74a7aAkGYITkCds5lGlmGTmDex6x4N+gRgr+alXVHB2gtqbVg5OLKhdQ4rH9M1GW0ofyxB7I3JN2N0LZaahTpSaOa4KrzCRG5pXKhMUuyDER3cwbxwrRHj6gkc9i/eiJ8D3XjZGxb+ZLWJxRRqNPI9kuTn15vsgBqFgfYFMSPwovq8wzcwz8WDI5VFXirXlvmZM3+I8EUi62BY0s=
  - secure: oWejPB56a+67DuO/F6G4r3MjCsBZcEw4ioKxHsYnXomnD78gkvp3fqX8gjGv5sjToEYAKScaJJvWG++AR4wwOnEADDkzgk/ljU4LpddM44Jjm26ypR2NCvghjjJrlZKhpTUBto8/nEySlxzLMK512CXtL+bStcS9R9dNQZbij2K/YaUCTyNUqYeG0TLXukmO1Z3r3idJmDTvQWOfQqxNBtY7MQ8JxjIledbf50YuTQuZ3RcNpaiBeFyymKSIzDka36U05d1OBrGLFOvHMxcLlARdOI0Q0Nig+Ba0sXtmJmXzWHS6qpohzWCb8Hzk7z8gK/Pg6I3ad/k6pRBn2CfwXMXQC8eNMhxHBK5BI2iCZE28lJERV455NZ9bU5FS4XMoYX54gQH88+oZGADRCeV6h1j/G3jALLNIrFDzbZj3zg5XA4jwekxgMkETTMIp2SjAH+kpf5mlxhMRkwggQz+RSNOzGLzNCAlymJ9TIFamTWGc7CHWpE/Qh0oghZKOPJpVdipqSPkwbXqyQGvcAgljJnpc5okanW3j7lmp6Ok2ZipsJL3jEg/Ki7FRPKprlvwgApPvN1StmPBUEQp8GuUEF/ROpMirqMFbsCDXnSKDmH6R9PT+9H5OBYz+ZJlB4PAMk5CAFCulsgEtR2J4eZTXmbhaQ1EpdLSJCVLEW+tSIeA=
before_deploy:
- export RELEASE_FILE_NAME=$(ls ../*.deb)
after_deploy:
- NOW=`date +%Y-%m-%d-%H-%M`
- cd ..
- git clone https://github.com/mariolukas/FabScanPi-Build-Raspbian.git
- cd FabScanPi-Build-Raspbian
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git tag v.${NOW} -m "new release ${RELEASE_FILE_NAME}"
- git push origin --tags
deploy:
  provider: releases
  skip_cleanup: true
  file_glob: true
  api_key:
    secure: k0Ms4zQL6KTWInxaS2G578OxmG2aJSicezcGESsDHg3RLI7zgyx4jn+3IdoGfZucXmMxjwPFpBvoVBYfJ4GY5ZrgV8ftvnReO7xn8obADtOmSupTy5eUX5S/K+b8VdjD/QQRO9Bn9lz7ekTauMqtv2usw93X3RTDFtEAtLwtBEuGMU4dhU1lHC/1HDxa0BGfhuEOsp9eedA641dwq3kVpw/6WRlpdyNLEL6l7HJ2ednOH+DXb5hTwSF+Wbg/Oe/pobn8xpFvYc8ZmlRVpiE0kL3lA4HZ5gdBCHAs9HuNsK8e3pKn9l71zqEFdZdbUylp/fFeN5uLYMnZSMKBOg03lRhtsICm6IN7d91Hazcd+vox5Jh0EBgKsEgrAoDSMjiMRj1ROnZXWgs/DYZh8nV+y23hY3BlvyD2AjwyxCHRLG4sIkGmhxe3EoaW1vBwZ4/QUp7AL6x9povUsJM4kU6sBu0+QaoKk1NKs+2xW4mpktS5i2WHuR/sJcmf8AWDkuTejSKBzmKJoSb2dluRYKHa7EpobA7hiCz+6Und13sGJDvF46QprCkuVmDeQc1wImpVj2Evn0KLRRq4z33mEtoMMbROJ1Pg7pXdaTvl9AxDHn60NIbfr7lWjcYIvaOpPSax5vCD6w2lDToDbwj/4K5mh80/bhOyWVCrfcJxQOYqxxQ=
  file: "${RELEASE_FILE_NAME}"
  on:
    tags: true
    repo: mariolukas/FabScanPi-Server
